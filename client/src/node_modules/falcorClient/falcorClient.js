const co = require("co")

module.exports = angular.module("falcorception.falcorClient", []).component("falcorClient", {
  templateUrl: "node_modules/falcorClient/falcorClient.html",
  bindings: {
    api: "<",
  },
  controller($scope, falcorFactory) {
    const ctrl = this
    ctrl.submit = co.wrap(function* (paths) {
      ctrl.error = false
      ctrl.response = null
      const model = falcorFactory(ctrl.api.url)
      try {
        const response = yield model.get(paths)
        ctrl.response = response.json
      } catch (errors) {
        ctrl.response = errors
        ctrl.error = true
      }
      $scope.$apply()
    })
  },
})
